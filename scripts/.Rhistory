}
plot.kay <- ggplot(added_sp_site,aes(x=ncrab,y=nsp)) +
geom_point() +
ylim(c(5,55)) +
labs(y="total prey species",x="number of crab") + ggtitle("Kayak Point") + theme_classic()
# clayton
site.dat.filter <- dat.filter %>% filter(Site=="CLAY")
all_sp_site <- c()
added_sp_site <- data.frame(ncrab=as.numeric(),
nsp=as.numeric())
for(i in seq(1,length(unique(site.dat.filter$crab_id)))){
new_sp <- site.dat.filter %>%
filter(crab_id==unique(site.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,species) %>%
distinct() %>%
filter(!(species %in% all_sp_site)) %>%
pull(species)
all_sp_site <- c(all_sp_site, new_sp)
added_sp_site <- added_sp_site %>% bind_rows(data.frame(ncrab=i, nsp=length(all_sp_site)))
}
plot.clay <- ggplot(added_sp_site,aes(x=ncrab,y=nsp)) +
geom_point() +
ylim(c(5,55)) +
labs(y="total prey species",x="number of crab") + ggtitle("Clayton Beach") + theme_classic()
plot_grid(plot.kay,plot.clay,ncol=2)
## family
all_fam <- c()
added_fam <- data.frame(ncrab=as.numeric(),
nfam=as.numeric())
for(i in seq(1,length(unique(dat.filter$crab_id)))){
new_fam <- dat.filter %>%
filter(crab_id==unique(dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,family) %>%
distinct() %>%
filter(!(family %in% all_fam)) %>%
pull(family)
all_fam <- c(all_fam, new_fam)
added_fam <- added_fam %>% bind_rows(data.frame(ncrab=i, nfam=length(all_fam)))
}
## order
all_ord <- c()
added_ord <- data.frame(ncrab=as.numeric(),
nord=as.numeric())
for(i in seq(1,length(unique(dat.filter$crab_id)))){
new_ord <- dat.filter %>%
filter(crab_id==unique(dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,order) %>%
distinct() %>%
filter(!(order %in% all_ord)) %>%
pull(order)
all_ord <- c(all_ord, new_ord)
added_ord <- added_ord %>% bind_rows(data.frame(ncrab=i, nord=length(all_ord)))
}
## class
all_class <- c()
added_class <- data.frame(ncrab=as.numeric(),
nclass=as.numeric())
for(i in seq(1,length(unique(dat.filter$crab_id)))){
new_class <- dat.filter %>%
filter(crab_id==unique(dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,class) %>%
distinct() %>%
filter(!(class %in% all_class)) %>%
pull(class)
all_class <- c(all_class, new_class)
added_class <- added_class %>% bind_rows(data.frame(ncrab=i, nclass=length(all_class)))
}
## phylum
all_phylum <- c()
added_phylum <- data.frame(ncrab=as.numeric(),
nphylum=as.numeric())
for(i in seq(1,length(unique(dat.filter$crab_id)))){
new_phylum <- dat.filter %>%
filter(crab_id==unique(dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,phylum) %>%
distinct() %>%
filter(!(phylum %in% all_phylum)) %>%
pull(phylum)
all_phylum <- c(all_phylum, new_phylum)
added_phylum <- added_phylum %>% bind_rows(data.frame(ncrab=i, nphylum=length(all_phylum)))
}
p1 <- ggplot(added_fam,aes(x=ncrab,y=nfam)) +
geom_point() +
labs(y="total families",x="number of crab") + theme_classic()
p2 <- ggplot(added_ord,aes(x=ncrab,y=nord)) +
geom_point() +
labs(y="total orders",x="number of crab") + theme_classic()
p3 <- ggplot(added_class,aes(x=ncrab,y=nclass)) +
geom_point() +
labs(y="total classes",x="number of crab") + theme_classic()
p4 <- ggplot(added_phylum,aes(x=ncrab,y=nphylum)) +
geom_point() +
labs(y="total phyla",x="number of crab") + theme_classic()
cowplot::plot_grid(p1,p2,p3,p4,ncol=4)
p1 <- ggplot(added_fam,aes(x=ncrab,y=nfam)) +
geom_point() +
labs(y="total families",x="number of crab") + theme_classic()
p2 <- ggplot(added_ord,aes(x=ncrab,y=nord)) +
geom_point() +
labs(y="total orders",x="number of crab") + theme_classic()
p3 <- ggplot(added_class,aes(x=ncrab,y=nclass)) +
geom_point() +
labs(y="total classes",x="number of crab") + theme_classic()
p4 <- ggplot(added_phylum,aes(x=ncrab,y=nphylum)) +
geom_point() +
labs(y="total phyla",x="number of crab") + theme_classic()
cowplot::plot_grid(p1,p2,p3,p4,ncol=4)
p1 <- ggplot(added_fam,aes(x=ncrab,y=nfam)) +
geom_point() +
labs(y="total families",x="number of crab") + theme_classic()
p2 <- ggplot(added_ord,aes(x=ncrab,y=nord)) +
geom_point() +
labs(y="total orders",x="") + theme_classic()
p3 <- ggplot(added_class,aes(x=ncrab,y=nclass)) +
geom_point() +
labs(y="total classes",x="number of crab") + theme_classic()
p4 <- ggplot(added_phylum,aes(x=ncrab,y=nphylum)) +
geom_point() +
labs(y="total phyla",x="") + theme_classic()
cowplot::plot_grid(p1,p2,p3,p4,ncol=4)
kay.dat.filter <- dat.filter %>% filter(Site=="KAY")
## order
all_order <- c()
added_order <- data.frame(ncrab=as.numeric(),
norder=as.numeric())
for(i in seq(1,length(unique(kay.dat.filter$crab_id)))){
new_order <- kay.dat.filter %>%
filter(crab_id==unique(kay.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,order) %>%
distinct() %>%
filter(!(order %in% all_order)) %>%
pull(order)
all_order <- c(all_order, new_order)
added_order <- added_order %>% bind_rows(data.frame(ncrab=i, norder=length(all_order)))
}
kp1 <- ggplot(added_order,aes(x=ncrab,y=norder)) +
geom_point() +
ylim(c(0,max(added_order$norder)+2)) +
labs(y="total orders",x="number of crab") + ggtitle("Kayak Pt - Eelgrass") + theme_classic()
kay.dat.filter <- dat.filter %>% filter(Site=="KAY-shell")
## order
all_order <- c()
added_order <- data.frame(ncrab=as.numeric(),
norder=as.numeric())
for(i in seq(1,length(unique(kay.dat.filter$crab_id)))){
new_order <- kay.dat.filter %>%
filter(crab_id==unique(kay.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,order) %>%
distinct() %>%
filter(!(order %in% all_order)) %>%
pull(order)
all_order <- c(all_order, new_order)
added_order <- added_order %>% bind_rows(data.frame(ncrab=i, norder=length(all_order)))
}
kp2 <- ggplot(added_order,aes(x=ncrab,y=norder)) +
geom_point() +
ylim(c(0,max(added_order$norder)+2)) +
labs(y="total orderes",x="number of crab") + ggtitle("Kayak Pt - Shell") + theme_classic()
kay.dat.filter <- dat.filter %>% filter(Site=="KAY-shell" | Site=="KAY")
## order
all_order <- c()
added_order <- data.frame(ncrab=as.numeric(),
norder=as.numeric())
for(i in seq(1,length(unique(kay.dat.filter$crab_id)))){
new_order <- kay.dat.filter %>%
filter(crab_id==unique(kay.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,order) %>%
distinct() %>%
filter(!(order %in% all_order)) %>%
pull(order)
all_order <- c(all_order, new_order)
added_order <- added_order %>% bind_rows(data.frame(ncrab=i, norder=length(all_order)))
}
kp3 <- ggplot(added_order,aes(x=ncrab,y=norder)) +
geom_point() +
ylim(c(0,max(added_order$norder)+2)) +
labs(y="total orders",x="number of crab") + ggtitle("Kayak Pt - All") + theme_classic()
plot_grid(kp1,kp2,kp3,ncol=3)
## phyla
kay.dat.filter <- dat.filter %>% filter(Site=="KAY")
all_phylum <- c()
added_phylum <- data.frame(ncrab=as.numeric(),
nphylum=as.numeric())
for(i in seq(1,length(unique(kay.dat.filter$crab_id)))){
new_phylum <- kay.dat.filter %>%
filter(crab_id==unique(kay.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,phylum) %>%
distinct() %>%
filter(!(phylum %in% all_phylum)) %>%
pull(phylum)
all_phylum <- c(all_phylum, new_phylum)
added_phylum <- added_phylum %>% bind_rows(data.frame(ncrab=i, nphylum=length(all_phylum)))
}
kp4 <- ggplot(added_phylum,aes(x=ncrab,y=nphylum)) +
geom_point() +
ylim(c(0,max(added_phylum$nphylum)+2)) +
labs(y="total phyla",x="number of crab") + ggtitle("Kayak Pt - Eelgrass") + theme_classic()
kay.dat.filter <- dat.filter %>% filter(Site=="KAY-shell")
all_phylum <- c()
added_phylum <- data.frame(ncrab=as.numeric(),
nphylum=as.numeric())
for(i in seq(1,length(unique(kay.dat.filter$crab_id)))){
new_phylum <- kay.dat.filter %>%
filter(crab_id==unique(kay.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,phylum) %>%
distinct() %>%
filter(!(phylum %in% all_phylum)) %>%
pull(phylum)
all_phylum <- c(all_phylum, new_phylum)
added_phylum <- added_phylum %>% bind_rows(data.frame(ncrab=i, nphylum=length(all_phylum)))
}
kp5 <- ggplot(added_phylum,aes(x=ncrab,y=nphylum)) +
geom_point() +
ylim(c(0,max(added_phylum$nphylum)+2)) +
labs(y="",x="number of crab") + ggtitle("Kayak Pt - Shell") + theme_classic()
kay.dat.filter <- dat.filter %>% filter(Site=="KAY-shell" | Site=="KAY")
all_phylum <- c()
added_phylum <- data.frame(ncrab=as.numeric(),
nphylum=as.numeric())
for(i in seq(1,length(unique(kay.dat.filter$crab_id)))){
new_phylum <- kay.dat.filter %>%
filter(crab_id==unique(kay.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,phylum) %>%
distinct() %>%
filter(!(phylum %in% all_phylum)) %>%
pull(phylum)
all_phylum <- c(all_phylum, new_phylum)
added_phylum <- added_phylum %>% bind_rows(data.frame(ncrab=i, nphylum=length(all_phylum)))
}
kp6 <- ggplot(added_phylum,aes(x=ncrab,y=nphylum)) +
geom_point() +
ylim(c(0,max(added_phylum$nphylum)+2)) +
labs(y="",x="number of crab") + ggtitle("Kayak Pt - All") + theme_classic()
plot_grid(kp1,kp2,kp3,kp4,kp5,kp6,ncol=3)
plot_grid(kp1,kp2,kp3,kp4,kp5,kp6,ncol=3)
## phyla
kay.dat.filter <- dat.filter %>% filter(Site=="KAY")
all_phylum <- c()
added_phylum <- data.frame(ncrab=as.numeric(),
nphylum=as.numeric())
for(i in seq(1,length(unique(kay.dat.filter$crab_id)))){
new_phylum <- kay.dat.filter %>%
filter(crab_id==unique(kay.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,phylum) %>%
distinct() %>%
filter(!(phylum %in% all_phylum)) %>%
pull(phylum)
all_phylum <- c(all_phylum, new_phylum)
added_phylum <- added_phylum %>% bind_rows(data.frame(ncrab=i, nphylum=length(all_phylum)))
}
kp4 <- ggplot(added_phylum,aes(x=ncrab,y=nphylum)) +
geom_point() +
ylim(c(0,max(added_phylum$nphylum)+2)) +
labs(y="total phyla",x="number of crab") + theme_classic()
kay.dat.filter <- dat.filter %>% filter(Site=="KAY-shell")
all_phylum <- c()
added_phylum <- data.frame(ncrab=as.numeric(),
nphylum=as.numeric())
for(i in seq(1,length(unique(kay.dat.filter$crab_id)))){
new_phylum <- kay.dat.filter %>%
filter(crab_id==unique(kay.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,phylum) %>%
distinct() %>%
filter(!(phylum %in% all_phylum)) %>%
pull(phylum)
all_phylum <- c(all_phylum, new_phylum)
added_phylum <- added_phylum %>% bind_rows(data.frame(ncrab=i, nphylum=length(all_phylum)))
}
kp5 <- ggplot(added_phylum,aes(x=ncrab,y=nphylum)) +
geom_point() +
ylim(c(0,max(added_phylum$nphylum)+2)) +
labs(y="",x="number of crab") + theme_classic()
kay.dat.filter <- dat.filter %>% filter(Site=="KAY-shell" | Site=="KAY")
all_phylum <- c()
added_phylum <- data.frame(ncrab=as.numeric(),
nphylum=as.numeric())
for(i in seq(1,length(unique(kay.dat.filter$crab_id)))){
new_phylum <- kay.dat.filter %>%
filter(crab_id==unique(kay.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,phylum) %>%
distinct() %>%
filter(!(phylum %in% all_phylum)) %>%
pull(phylum)
all_phylum <- c(all_phylum, new_phylum)
added_phylum <- added_phylum %>% bind_rows(data.frame(ncrab=i, nphylum=length(all_phylum)))
}
kp6 <- ggplot(added_phylum,aes(x=ncrab,y=nphylum)) +
geom_point() +
ylim(c(0,max(added_phylum$nphylum)+2)) +
labs(y="",x="number of crab") + theme_classic()
plot_grid(kp1,kp2,kp3,kp4,kp5,kp6,ncol=3)
clay.dat.filter <- dat.filter %>% filter(Site=="CLAY")
## order
all_order <- c()
added_order <- data.frame(ncrab=as.numeric(),
norder=as.numeric())
for(i in seq(1,length(unique(clay.dat.filter$crab_id)))){
new_order <- clay.dat.filter %>%
filter(crab_id==unique(clay.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,order) %>%
distinct() %>%
filter(!(order %in% all_order)) %>%
pull(order)
all_order <- c(all_order, new_order)
added_order <- added_order %>% bind_rows(data.frame(ncrab=i, norder=length(all_order)))
}
cl1 <- ggplot(added_order,aes(x=ncrab,y=norder)) +
geom_point() +
ylim(c(0,max(added_order$norder)+2)) +
labs(y="total orders",x="") + ggtitle("Clayton Beach") + theme_classic()
all_phylum <- c()
added_phylum <- data.frame(ncrab=as.numeric(),
nphylum=as.numeric())
for(i in seq(1,length(unique(clay.dat.filter$crab_id)))){
new_phylum <- clay.dat.filter %>%
filter(crab_id==unique(clay.dat.filter$crab_id)[i]) %>%
filter(rank=="species") %>%
dplyr::select(crab_id,phylum) %>%
distinct() %>%
filter(!(phylum %in% all_phylum)) %>%
pull(phylum)
all_phylum <- c(all_phylum, new_phylum)
added_phylum <- added_phylum %>% bind_rows(data.frame(ncrab=i, nphylum=length(all_phylum)))
}
cl2 <- ggplot(added_phylum,aes(x=ncrab,y=nphylum)) +
geom_point() +
ylim(c(0,max(added_phylum$nphylum)+2)) +
labs(y="total phyla",x="number of crab") + theme_classic()
plot_grid(cl1,cl2,ncol=2)
taxa_summary <- dat.filter %>%
mutate(total_reads=sum(dat.filter$nReads),
total_crab=length(unique((dat.filter$crab_id)))) %>%
group_by(taxon, rank,class,phylum) %>%
summarise(n_crab=length(unique(crab_id)),
prop_crab=n_crab/total_crab,
n_reads=sum(nReads),
prop_reads=n_reads/total_reads) %>%
distinct() %>% arrange(n_crab)
site.totals.sp <- dat.filter %>% filter(rank=="species") %>%
group_by(Site) %>%
summarise(total_reads=sum(nReads),
total_crab=length(unique(crab_id)))
class_summary_bysite <- dat.filter %>%
filter(rank=="species") %>%
group_by(class, Site) %>%
summarise(n_crab=length(unique(crab_id)),
n_reads=sum(nReads)) %>%
left_join(site.totals.sp,by="Site") %>%
mutate(prop_crab=n_crab/total_crab,
prop_reads=n_reads/total_reads) %>%
distinct() %>% arrange(n_crab)
plotdat <- class_summary_bysite %>%
dplyr::select(class,Site,n_crab,prop_reads) %>%
arrange(n_crab) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
mutate(class=factor(class, levels=unique(class)))
plotdat %>%
pivot_longer(cols=c(n_crab,prop_reads),names_to="metric",values_to="value") %>%
mutate(metric=ifelse(metric=="n_crab","Crab Count","Prop Sequence Reads")) %>%
ggplot(aes(y=value,x=factor(class, levels=unique(plotdat$class)))) +
facet_grid(cols=vars(metric),scales="free") +
geom_col(aes(fill=Site), position="dodge") +
ggtitle("Classes") +
coord_flip() + theme_bw() + theme(axis.title=element_blank(),
strip.text=element_text(size=12),
axis.text.x=element_text(size=12),
axis.text.y=element_text(size=10))
site.totals.sp <- dat.filter %>% filter(rank=="species") %>%
group_by(Site) %>%
summarise(total_crab=length(unique(crab_id)))
class_summary_bysite <- dat.filter %>%
filter(rank=="species") %>%
group_by(class, Site, rank) %>%
summarise(n_crab=length(unique(crab_id))) %>%
left_join(site.totals.sp,by="Site") %>%
mutate(prop_crab=n_crab/total_crab) %>%
distinct() %>% arrange(n_crab)
View(class_summary_bysite)
class_summary_bysite <- dat.filter %>%
filter(rank=="species") %>%
dplyr::select(Site,crab_id,class,phylum) %>%
pivot_longer(cols=c(class,phylum), names_to="rank", values_to="taxonomy") %>%
group_by(Site, rank) %>%
summarise(n_crab=length(unique(crab_id))) %>%
left_join(site.totals.sp,by="Site") %>%
mutate(prop_crab=n_crab/total_crab) %>%
distinct() %>% arrange(n_crab)
View(class_summary_bysite)
class_summary_bysite <- dat.filter %>%
filter(rank=="species") %>%
dplyr::select(Site,crab_id,class,phylum) %>%
pivot_longer(cols=c(class,phylum), names_to="rank", values_to="taxonomy") %>%
group_by(Site, rank, taxonomy) %>%
summarise(n_crab=length(unique(crab_id))) %>%
left_join(site.totals.sp,by="Site") %>%
mutate(prop_crab=n_crab/total_crab) %>%
distinct() %>% arrange(n_crab)
plotdat <- class_summary_bysite %>%
arrange(n_crab) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
mutate(class=factor(class, levels=unique(class)))
plotdat <- class_summary_bysite %>%
arrange(n_crab) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
mutate(taxonomy=factor(taxonomy, levels=unique(taxonomy)))
site.totals.sp <- dat.filter %>% filter(rank=="species") %>%
group_by(Site) %>%
summarise(total_crab=length(unique(crab_id)))
class_summary_bysite <- dat.filter %>%
filter(rank=="species") %>%
dplyr::select(Site,crab_id,class,phylum) %>%
pivot_longer(cols=c(class,phylum), names_to="rank", values_to="taxonomy") %>%
group_by(Site, rank, taxonomy) %>%
summarise(n_crab=length(unique(crab_id))) %>%
left_join(site.totals.sp,by="Site") %>%
mutate(prop_crab=n_crab/total_crab) %>%
distinct() %>% arrange(n_crab)
plotdat <- class_summary_bysite %>%
arrange(n_crab) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
mutate(taxonomy=factor(taxonomy, levels=unique(taxonomy)))
plotdat %>%
ggplot(aes(y=prop_crab,x=factor(taxonomy, levels=unique(plotdat$taxonomy)))) +
facet_grid(cols=vars(rank),scales="free") +
geom_col(aes(fill=Site), position="dodge") +
coord_flip() + theme_bw() + theme(axis.title=element_blank(),
strip.text=element_text(size=12),
axis.text.x=element_text(size=12),
axis.text.y=element_text(size=10))
plotdat %>%
ggplot(aes(y=prop_crab,x=factor(taxonomy, levels=unique(plotdat$taxonomy)))) +
facet_grid(cols=vars(rank),scales="free_x") +
geom_col(aes(fill=Site), position="dodge") +
coord_flip() + theme_bw() + theme(axis.title=element_blank(),
strip.text=element_text(size=12),
axis.text.x=element_text(size=12),
axis.text.y=element_text(size=10))
plotdat %>%
ggplot(aes(y=prop_crab,x=factor(taxonomy, levels=unique(plotdat$taxonomy)))) +
facet_wrap(~rank,scales="free_x") +
geom_col(aes(fill=Site), position="dodge") +
coord_flip() + theme_bw() + theme(axis.title=element_blank(),
strip.text=element_text(size=12),
axis.text.x=element_text(size=12),
axis.text.y=element_text(size=10))
plotdat %>%
ggplot(aes(y=prop_crab,x=factor(taxonomy, levels=unique(plotdat$taxonomy)))) +
facet_wrap(~rank,scales="free") +
geom_col(aes(fill=Site), position="dodge") +
coord_flip() + theme_bw() + theme(axis.title=element_blank(),
strip.text=element_text(size=12),
axis.text.x=element_text(size=12),
axis.text.y=element_text(size=10))
taxa_summary <- dat.filter %>%
mutate(total_reads=sum(dat.filter$nReads),
total_crab=length(unique((dat.filter$crab_id)))) %>%
group_by(taxon, rank,class,phylum) %>%
summarise(n_crab=length(unique(crab_id)),
prop_crab=n_crab/total_crab,
n_reads=sum(nReads),
prop_reads=n_reads/total_reads) %>%
distinct() %>% arrange(n_crab)
plotdat <- taxa_summary %>%
filter(n_crab > 1) %>%
dplyr::select(-prop_crab,-n_reads) %>%
arrange(n_crab) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
mutate(taxon=factor(taxon, levels=taxon))
plotdat %>%
pivot_longer(cols=c(n_crab,prop_reads),names_to="metric",values_to="value") %>%
mutate(metric=ifelse(metric=="n_crab","Crab Count","Prop Sequence Reads")) %>%
ggplot(aes(y=value,x=factor(taxon, levels=plotdat$taxon))) +
facet_grid(cols=vars(metric),scales="free") +
geom_col(aes(fill=rank)) +
coord_flip() + theme_bw() + theme(axis.title=element_blank(),
strip.text=element_text(size=12),
axis.text.x=element_text(size=12),
axis.text.y=element_text(size=10))
taxa_summary <- dat.filter %>%
mutate(total_reads=sum(dat.filter$nReads),
total_crab=length(unique((dat.filter$crab_id)))) %>%
group_by(taxon, rank,class,phylum) %>%
summarise(n_crab=length(unique(crab_id)),
prop_crab=n_crab/total_crab,
n_reads=sum(nReads),
prop_reads=n_reads/total_reads) %>%
distinct() %>% arrange(n_crab)
plotdat <- taxa_summary %>%
filter(n_crab > 5) %>%
dplyr::select(-prop_crab,-n_reads) %>%
arrange(n_crab) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
mutate(taxon=factor(taxon, levels=taxon))
plotdat %>%
pivot_longer(cols=c(n_crab,prop_reads),names_to="metric",values_to="value") %>%
mutate(metric=ifelse(metric=="n_crab","Crab Count","Prop Sequence Reads")) %>%
ggplot(aes(y=value,x=factor(taxon, levels=plotdat$taxon))) +
facet_grid(cols=vars(metric),scales="free") +
geom_col(aes(fill=rank)) +
coord_flip() + theme_bw() + theme(axis.title=element_blank(),
strip.text=element_text(size=12),
axis.text.x=element_text(size=12),
axis.text.y=element_text(size=10))
